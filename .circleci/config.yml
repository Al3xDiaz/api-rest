 version: 2.1

 orbs:
  win: circleci/windows@2.2.0

 jobs:
    build:
     executor: win/default     
    
     steps:
       - checkout
       - run: dotnet test
       - run: dotnet build
    deploy:
      machine: 
        image: ubuntu-1604:201903-01
      steps:
        - run:
            name: Deploy Over SSH
            command: |
              ssh $SSH_USER@$SSH_HOST "sh api-rest/desplegar.sh"
 workflows:
    build-and-deploy:
      jobs:
        - build
        - deploy:
            requires:
              - build # only deploy once build job has completed
            filters:
              branches:
                only: master # only deploy on the master branch